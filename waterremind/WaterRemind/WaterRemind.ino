


#include <Arduino.h>
#include <U8g2lib.h>
#include <string.h>
//#include <DS1302.h>
#ifdef U8X8_HAVE_HW_SPI
#include <SPI.h>
#endif
#ifdef U8X8_HAVE_HW_I2C
#include <Wire.h>
#endif


U8G2_SSD1306_128X32_UNIVISION_F_SW_I2C u8g2(U8G2_R0, /* clock=*/ SCL, /* data=*/ SDA, /* reset=*/ U8X8_PIN_NONE);   // Adafruit Feather ESP8266/32u4 Boards + FeatherWing OLED
//U8G2_SSD1306_128X32_WINSTAR_F_HW_I2C u8g2(U8G2_R0, /* reset=*/ U8X8_PIN_NONE, /* clock=*/ SCL, /* data=*/ SDA);   // pin remapping with ESP8266 HW I2C

//DS1302 rtc(2, 3, 4); // RST, DAT, CLK
//Time t1;
//Time t2;
int t3;
char tt;
int bee = 13;
int redPin = A0;
int val;

#define bmp1_x 128
#define bmp1_y 32
 
static const unsigned char bmp1[] U8X8_PROGMEM = {
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x03,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x80,0x0C,0x00,0x00,0x01,0x00,0x00,0xFC,0x7F,0x00,0x00,0x00,0x00,0x00,0x00,0x02,0xC0,0x18,0x00,0x00,0x01,0x00,0x00,0x0C,0xC0,0x00,0x00,0x08,0x00,0x00,
0x00,0x03,0x20,0x10,0x00,0x10,0x01,0x00,0x00,0x04,0x80,0x00,0x00,0x08,0x00,0x00,0x80,0x01,0x30,0x20,0x00,0x18,0x31,0x00,0x00,0x04,0x00,0x01,0x00,0x08,0x00,0x00,
0x80,0x00,0x18,0xC0,0x00,0x08,0x21,0x00,0x00,0xFC,0x3F,0x01,0x00,0x08,0x00,0x00,0x40,0x00,0x0C,0x80,0x00,0x0C,0x01,0x00,0x00,0x04,0x00,0x01,0x00,0x08,0x00,0x00,
0x40,0x00,0x0E,0x60,0x01,0x0E,0x01,0x00,0x1F,0x0C,0x80,0x00,0x00,0x08,0x00,0x00,0x20,0x04,0xFB,0xFF,0x07,0x0A,0x02,0xC0,0x61,0x0C,0xE0,0x00,0x00,0x08,0x10,0x00,
0x20,0x86,0x01,0x00,0x0C,0x09,0x02,0xC0,0xC0,0xFC,0x1F,0x00,0x06,0x00,0x18,0x00,0x30,0xC7,0x00,0x00,0x80,0x08,0x02,0x80,0x80,0x0C,0x00,0x00,0x1E,0x04,0x0C,0x00,
0xD0,0x02,0x00,0x00,0xC0,0x08,0xFA,0x80,0x80,0x02,0x1E,0x00,0x60,0x04,0x04,0x00,0x38,0x03,0xF0,0x1F,0x40,0xF8,0x07,0x80,0x80,0xFF,0x61,0x00,0x40,0x04,0x02,0x00,
0x00,0x01,0x1C,0x30,0xE0,0x1D,0x02,0x80,0x40,0x83,0x80,0x00,0x40,0x84,0x01,0x00,0x80,0x01,0x0C,0x60,0x60,0x08,0x04,0x80,0x20,0xC2,0x80,0x00,0x60,0xC4,0x00,0x00,
0x80,0x00,0x04,0xC0,0x00,0x08,0x04,0x00,0x10,0x44,0x80,0x00,0x30,0x74,0x00,0x00,0xC0,0x00,0x04,0x80,0x00,0xC8,0x04,0x80,0x0F,0xC4,0x80,0x01,0x08,0x34,0x00,0x00,
0x40,0x06,0x04,0x80,0x00,0x68,0x08,0x00,0x00,0xA4,0x03,0x01,0x06,0xE4,0x00,0x00,0x60,0x02,0x04,0x80,0x01,0x18,0x48,0x00,0x00,0x34,0x3E,0x81,0x03,0x84,0x01,0x00,
0xA0,0x03,0x04,0x80,0x01,0x0E,0x28,0x00,0x00,0x14,0x20,0xC1,0x00,0x04,0x02,0x00,0xE0,0x00,0x04,0x80,0x80,0x0D,0x28,0x00,0x00,0x06,0x00,0x61,0x00,0x04,0x0C,0x00,
0x60,0x60,0x04,0x80,0x60,0x04,0x10,0x00,0x00,0xFE,0xFF,0x18,0x08,0x04,0x18,0x00,0x00,0x30,0x04,0xC0,0x00,0x04,0x10,0x00,0x00,0x00,0x80,0x08,0x18,0x04,0x30,0x00,
0x00,0x18,0x1C,0x40,0xC0,0x04,0x28,0x00,0x00,0x00,0x80,0x00,0x30,0x04,0xE0,0x00,0x00,0x0C,0xFC,0x3F,0x80,0x07,0x2C,0x02,0x00,0x80,0x80,0x00,0x20,0x04,0x80,0x03,
0x00,0x06,0x8C,0x03,0x00,0x03,0x60,0x02,0x00,0x00,0x83,0x00,0x80,0x04,0x00,0x06,0x00,0x03,0x00,0x00,0x00,0x03,0xC0,0x02,0x00,0x00,0xC6,0x00,0x00,0x05,0x00,0x00,
0x80,0x01,0x00,0x00,0x00,0x00,0x80,0x03,0x00,0x00,0x4C,0x00,0x00,0x06,0x00,0x00,0x60,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x78,0x00,0x00,0x00,0x00,0x00,
0x20,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x30,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,

};

#define bmp2_x 128
#define bmp2_y 16
static const unsigned char bmp2[] U8X8_PROGMEM = {
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x0C,0x00,0x00,0x08,0x00,0x00,0xF0,0x03,0x41,0x00,0x00,0x00,0x00,0x00,0x00,
0xE0,0x1F,0xF8,0x03,0x88,0x0F,0x60,0x10,0x02,0x41,0x00,0x00,0x01,0x1F,0x20,0x00,0x30,0x02,0x88,0x00,0x48,0x08,0xBC,0xF0,0x03,0xF9,0x3F,0x00,0x01,0x11,0x20,0x00,
0x00,0x02,0x80,0x00,0xC8,0x0F,0xA0,0x30,0x83,0x1F,0x21,0x00,0x01,0x1F,0x20,0x00,0x00,0x02,0x80,0x00,0x9C,0x0C,0xE0,0xF0,0x01,0x91,0x21,0x07,0x79,0x15,0x22,0x00,
0x00,0x0F,0xE0,0x07,0x88,0x07,0xFC,0x03,0x00,0x81,0x80,0xF5,0x49,0x1B,0xAE,0x03,0xC0,0x01,0x80,0x00,0x18,0x01,0xA4,0x32,0x01,0xE7,0x9F,0x87,0xC8,0x3F,0xE8,0x00,
0x00,0x31,0x80,0x08,0x1C,0x3F,0xB4,0x9A,0xC0,0x81,0x82,0xA4,0xE8,0x26,0xF6,0x00,0x00,0x21,0x80,0x10,0xE8,0x03,0x14,0xEF,0x07,0x81,0x83,0xE7,0xB8,0x22,0x93,0x03,
0x00,0x01,0x00,0x00,0xC8,0x1E,0xE4,0x82,0x01,0x82,0x01,0xC0,0x80,0x3F,0x14,0x06,0x00,0x00,0xF0,0x7F,0x68,0x03,0x04,0xC2,0x83,0xC2,0x00,0x80,0x80,0x1C,0x1C,0x1C,
0xF0,0xFF,0x01,0x40,0x2E,0x06,0x04,0x82,0x80,0xE3,0x00,0xA0,0x80,0x17,0x18,0x10,0x00,0x00,0x00,0x00,0x0C,0x38,0xC4,0xFB,0x07,0xB3,0x03,0xE0,0x00,0x18,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0xE0,0x30,0x00,0x00,0x00,0x06,0xC0,0x00,0x18,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
};


void setup(void) {
  u8g2.setBusClock(200000);
  u8g2.begin();

  
  
  Serial.begin(9600);
  //t1 = rtc.getTime();
  pinMode(bee,OUTPUT);
    
}

void loop(void) {
  int i;
  char a[10];
  
  val=digitalRead(redPin);//读取模拟接口的值

  Serial.println(val);//输出模拟接口的值
  Serial.println(rtc.getTimeStr());
  u8g2.setFont(u8g2_font_ncenB08_tr);	// choose a suitable font
  if (val==0){
  if (t3<180){
    u8g2.clearBuffer();
    u8g2.drawXBMP(0,0, bmp2_x, bmp2_y, bmp2);
//    u8g2.sendBuffer();
//    u8g2.firstPage();
//    do{
    //放下杯子开始计时
//    u8g2.clearBuffer();
    itoa(t3,tt,10);
//    u8g2.drawXBMP(27,0, bmp2_x, bmp2_y, bmp2);
//    u8g2.drawStr(45,15,"CZW CY");
    u8g2.drawFrame(0,25,102,7);
    u8g2.drawBox(2,27,t3*0.5555,3);
    itoa(t3*0.55,a,10);
    u8g2.drawStr(104,31,a);
    u8g2.drawStr(116,31,"%");  
    delay(100);
    t3+=1;
    
//    }while(u8g2.nextPage());
    u8g2.sendBuffer();
    delay(9900);
//    }
  }
  else{
    t3=0;
    u8g2.clearBuffer();
    u8g2.drawXBMP(0,0, bmp1_x, bmp1_y, bmp1);
//    u8g2.drawXBMP(30,16, bmp3_x, bmp3_y, bmp3);
    u8g2.sendBuffer();
    
    
    digitalWrite(bee,HIGH);
    delay(200);
    digitalWrite(bee,LOW);
    delay(50);
    digitalWrite(bee,HIGH);
    delay(200);
    digitalWrite(bee,LOW);
    delay(100);
    digitalWrite(bee,HIGH);
    delay(200);
    digitalWrite(bee,LOW);
    delay(50);
    digitalWrite(bee,HIGH);
    delay(200);
    digitalWrite(bee,LOW);
    delay(100);
    digitalWrite(bee,HIGH);
    delay(200);
    digitalWrite(bee,LOW);
    delay(50);
    digitalWrite(bee,HIGH);
    delay(200);
    digitalWrite(bee,LOW);
    delay(10000);
    u8g2.sendBuffer();
    
    
    //响
    }
  }
  else{
    //拿起杯子
    t3=0;
    u8g2.clearBuffer();
    u8g2.sendBuffer();
    }
}
