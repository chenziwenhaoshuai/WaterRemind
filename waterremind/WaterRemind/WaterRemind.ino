


#include <Arduino.h>
#include <U8g2lib.h>
#include <string.h>
#include <DS1302.h>
#ifdef U8X8_HAVE_HW_SPI
#include <SPI.h>
#endif
#ifdef U8X8_HAVE_HW_I2C
#include <Wire.h>
#endif


U8G2_SSD1306_128X32_UNIVISION_F_SW_I2C u8g2(U8G2_R0, /* clock=*/ SCL, /* data=*/ SDA, /* reset=*/ U8X8_PIN_NONE);   // Adafruit Feather ESP8266/32u4 Boards + FeatherWing OLED
DS1302 rtc(2, 3, 4); // RST, DAT, CLK
Time t1;
Time t2;
int t3;
char tt;
int bee = 13;
int redPin = A0;
int val;

#define bmp1_x 78
#define bmp1_y 16
 
static const unsigned char bmp1[] U8X8_PROGMEM = {
0x00,0x00,0x00,0x00,0x00,0x00,0x08,0x00,0x00,0x00,0x00,0x80,0x0F,0x00,0x00,0x00,0x08,0x00,0x00,0x00,0x00,0x80,0x08,0x00,0x10,0x00,0x08,0x06,0x80,0x00,0x00,0x80,
0x0F,0x00,0x18,0x00,0x08,0x04,0x80,0x0C,0x00,0x98,0x08,0x40,0x88,0x80,0x39,0x0C,0xC0,0x04,0x00,0xB4,0x0F,0x80,0x4B,0x00,0x8F,0x38,0x40,0x04,0x00,0xA4,0x1F,0x00,
0x3B,0x60,0xEA,0x0F,0x40,0x04,0x00,0xE4,0x34,0x80,0x19,0x60,0x3F,0x40,0x60,0x04,0x00,0xDC,0x26,0x60,0x38,0xE0,0x09,0x61,0x20,0x04,0x00,0x80,0x27,0x3C,0x48,0x00,
0x08,0x21,0x00,0x04,0x00,0x80,0x2D,0x00,0x89,0x01,0x0A,0x11,0x00,0x00,0x00,0x80,0x38,0x00,0x0B,0x03,0x0E,0xFB,0x30,0x00,0x00,0x80,0x1F,0x00,0x0E,0x00,0x0C,0x0F,
0x30,0x07,0x00,0x00,0x18,0x00,0x00,0x00,0xC4,0x02,0x00,0x07,0x00,0x00,0x08,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,

};

#define bmp2_x 78
#define bmp2_y 16
static const unsigned char bmp2[] U8X8_PROGMEM = {
0x00,0x00,0x00,0x00,0x00,0x00,0x08,0x00,0x00,0x00,0x00,0x80,0x0F,0x00,0x00,0x00,0x08,0x00,0x00,0x00,0x00,0x80,0x08,0x00,0x10,0x00,0x08,0x06,0x80,0x00,0x00,0x80,
0x0F,0x00,0x18,0x00,0x08,0x04,0x80,0x0C,0x00,0x98,0x08,0x40,0x88,0x80,0x39,0x0C,0xC0,0x04,0x00,0xB4,0x0F,0x80,0x4B,0x00,0x8F,0x38,0x40,0x04,0x00,0xA4,0x1F,0x00,
0x3B,0x60,0xEA,0x0F,0x40,0x04,0x00,0xE4,0x34,0x80,0x19,0x60,0x3F,0x40,0x60,0x04,0x00,0xDC,0x26,0x60,0x38,0xE0,0x09,0x61,0x20,0x04,0x00,0x80,0x27,0x3C,0x48,0x00,
0x08,0x21,0x00,0x04,0x00,0x80,0x2D,0x00,0x89,0x01,0x0A,0x11,0x00,0x00,0x00,0x80,0x38,0x00,0x0B,0x03,0x0E,0xFB,0x30,0x00,0x00,0x80,0x1F,0x00,0x0E,0x00,0x0C,0x0F,
0x30,0x07,0x00,0x00,0x18,0x00,0x00,0x00,0xC4,0x02,0x00,0x07,0x00,0x00,0x08,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
};


void setup(void) {
  u8g2.setBusClock(200000);
  u8g2.begin();
  Serial.begin(9600);
  t1 = rtc.getTime();
  pinMode(bee,OUTPUT);
    
}

void loop(void) {
  int i;
  char a[10];
  
  val=digitalRead(redPin);//读取模拟接口的值

  Serial.println(val);//输出模拟接口的值
  Serial.println(rtc.getTimeStr());
  u8g2.setFont(u8g2_font_ncenB08_tr);	// choose a suitable font
  if (val==0){
  if (t3<180){
    u8g2.firstPage();
    do{
    //放下杯子开始计时
    u8g2.clearBuffer();
    itoa(t3,tt,10);
    u8g2.drawXBMP(27,0, bmp2_x, bmp2_y, bmp2);
//    u8g2.drawStr(45,15,"CZW CY");
    u8g2.drawFrame(0,25,102,7);
    u8g2.drawBox(2,27,t3*0.5555,3);
    itoa(t3*0.55,a,10);
    u8g2.drawStr(104,31,a);
    u8g2.drawStr(116,31,"%");  
    
    t3+=1;
    }while(u8g2.nextPage());
    //u8g2.sendBuffer();
    delay(10000);
  //  }
  }
  else{
    t3=0;
    u8g2.clearBuffer();
    u8g2.drawXBMP(30,10, bmp1_x, bmp1_y, bmp1);
//    u8g2.drawXBMP(30,16, bmp3_x, bmp3_y, bmp3);
    u8g2.sendBuffer();
    
    
    digitalWrite(bee,HIGH);
    delay(200);
    digitalWrite(bee,LOW);
    delay(50);
    digitalWrite(bee,HIGH);
    delay(200);
    digitalWrite(bee,LOW);
    delay(100);
    digitalWrite(bee,HIGH);
    delay(200);
    digitalWrite(bee,LOW);
    delay(50);
    digitalWrite(bee,HIGH);
    delay(200);
    digitalWrite(bee,LOW);
    delay(100);
    digitalWrite(bee,HIGH);
    delay(200);
    digitalWrite(bee,LOW);
    delay(50);
    digitalWrite(bee,HIGH);
    delay(200);
    digitalWrite(bee,LOW);
    delay(10000);
    u8g2.sendBuffer();
    
    
    //响
    }
  }
  else{
    //拿起杯子
    t3=0;
    u8g2.clearBuffer();
    u8g2.sendBuffer();
    }
}

